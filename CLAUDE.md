# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Bike Condition is a Next.js application that displays Strava bike condition and maintenance tracking. It integrates with the Strava API via OAuth to show bike data and component wear status.

## Project goals

You are assisting in the development of a cycling component wear‑tracking application.  
The purpose of the app is to measure and visualize wear on bicycle components based on riding distance.

High‑level goals:

- Integrate with Strava for authentication and retrieval of the user’s bikes and ride data.
- Allow the user to select one of their Strava‑registered bikes.
- Track total distance ridden per bike and automatically update distance‑based wear on each component.
- Each component has a recommended replacement interval (e.g., a chain at 3000 km).  
  The app should calculate progress toward this limit and provide:
  - visual indicators when components approach or exceed recommended wear thresholds
  - later: optional email notifications reminding the user to replace components
- Implement a database to store user data, component states, and persistent login sessions.
- Present the user with clean, modern UI including graphs and visualizations of component wear over time.

Interactive dashboard & SVG manipulation:

- The main dashboard will use an SVG illustration of a bicycle.
- Users should be able to click on individual components in the SVG to view wear data, history, and replacement recommendations.
- Use D3.js or similar libraries to manipulate SVG elements dynamically, highlight selected components, and animate wear progression.
- Support interactive visualizations such as progress arcs, color‑coded wear states, and component‑specific graphs.

Your role:

- Help plan architecture, data models, and database structure.
- Suggest implementation strategies for Strava integration and persistent authentication.
- Propose UI/UX patterns for visualizing wear, alerts, and interactive SVG components.
- Assist in breaking down tasks, writing code, and refining the overall system design.
- Ensure all suggestions align with the project’s purpose: accurate wear tracking, clear visual feedback, and a smooth user experience.

## Design style guide:

- The UI should be clean, simple, and visually appealing, with minimal distractions.
- Use shadcn/ui components as the primary design system for consistent styling and interaction patterns.
- Visualizations should be clear and intuitive, including:
  - progress bars showing component wear relative to recommended replacement distance
  - graphs illustrating historical wear progression or ride‑based accumulation
  - color‑coded states (e.g., green → yellow → red) to indicate component health
- The main dashboard layout:
  - Left side: an SVG illustration of a road bike
    - Users can click individual components in the SVG to view detailed wear information
    - SVG elements should highlight or animate when selected
  - Right side: statistics, progress bars, and component details
    - Show current distance, recommended replacement interval, and percentage toward wear limit
- The MVP does not require advanced animations or complex visual design; prioritize clarity and usability.
- All interactive SVG behavior (highlighting, selection, transitions) may be implemented using D3.js or similar libraries.
- Maintain a cohesive visual hierarchy with consistent spacing, typography, and color usage.

## Commands

```bash
npm run dev      # Start development server
npm run build    # Build for production
npm start        # Start production server
npm run lint     # Run ESLint
```

## Tech Stack

- Next.js 14 with App Router (want to upgrade to Next.js 16)
- React 18, TypeScript (strict mode) (want to upgrade to React 19)
- NextAuth for Strava OAuth
- Tailwind CSS for styling
- **shadcn/ui** as the component library (New York style, CSS variables)
- Lucide React for icons (via shadcn)
- Zod for validation
- React hook form for form
- Zustand for global states

## shadcn/ui Component System

**ALL UI components must use shadcn/ui.** This is the primary design system for the project.

### Setup

- `components.json` configures shadcn (New York style, RSC enabled, TypeScript)
- UI primitives live in `src/components/ui/` (auto-generated by shadcn CLI)
- Custom/composed components live in `src/components/` (use shadcn primitives)
- Utility function `cn()` from `src/lib/utils.ts` for merging Tailwind classes

### Rules for components

1. **Always use shadcn/ui primitives** instead of raw HTML elements:
   - `<Button>` instead of `<button>`
   - `<Card>`, `<CardHeader>`, `<CardContent>` instead of custom card divs
   - `<Badge>` instead of custom status spans
   - `<Progress>` instead of custom progress bars
   - `<Tooltip>` for hover information
   - `<Skeleton>` for loading states
2. **Never write custom CSS for components** that shadcn already provides
3. **Use Lucide React icons** (`lucide-react`) instead of `react-icons`
4. Use the `cn()` utility for conditional/merged class names

### shadcn MCP (for Claude Code)

The shadcn MCP server is configured and provides direct access to the shadcn registry.
When building or modifying components, use these MCP tools:

| Tool | Purpose |
|------|---------|
| `search_items_in_registries` | Find components by name (e.g., "button", "dialog") |
| `view_items_in_registries` | View component source code and API |
| `get_item_examples_from_registries` | See usage examples and demos |
| `get_add_command_for_items` | Get the CLI install command |
| `get_audit_checklist` | Verify component installation |

**Workflow for adding a new shadcn component:**
1. Search: `search_items_in_registries` with `registries: ["@shadcn"]`
2. Review: `view_items_in_registries` for API details
3. Examples: `get_item_examples_from_registries` for usage patterns
4. Install: `get_add_command_for_items` → run the `pnpm dlx shadcn@latest add` command
5. Verify: `get_audit_checklist` to confirm everything works

### Installed shadcn components

- Button (`@shadcn/button`) — used in StravaLoginButton, SyncButton
- Card (`@shadcn/card`) — used in SelectedBike, ComponentCard, page.tsx bike list
- Badge (`@shadcn/badge`) — used in StatusBadge (wear status), Primary badge
- Progress (`@shadcn/progress`) — used in ComponentCard (wear bars), extended with `indicatorClassName` prop
- Tooltip (`@shadcn/tooltip`) — available for future use
- Skeleton (`@shadcn/skeleton`) — used in StravaLoginButton loading state

### Component migration status

All components migrated to shadcn/ui:
- [x] `StravaLoginButton` — `<Button>` + `<Skeleton>` + `lucide-react` User icon
- [x] `SyncButton` — `<Button>` + `lucide-react` RefreshCw icon
- [x] `selectedBike/SelectedBike` — `<Card>` + `<CardHeader>` + `<CardContent>` + `<Badge>`
- [x] `selectedBike/ComponentCard` — `<Card>` + `<Progress>` with color-coded wear indicator
- [x] `selectedBike/StatusBadge` — `<Badge>` with custom warn/critical styles
- [x] `selectedBike/ProgressBar` — replaced with `<Progress indicatorClassName={...}>`
- [x] `BikeDashboard` — `<Card>` + `<Badge>` + `lucide-react` Bike icon (bike selector)
- [x] `page.tsx` — delegates to `<BikeDashboard>` for bike display
- [x] All `react-icons` imports removed — `lucide-react` used exclusively

## Architecture

### Directory Structure

- `src/app/` - Next.js App Router pages and API routes
- `src/components/` - React components (each in its own folder)
- `src/lib/` - Shared utilities, auth, database, Strava integration

### Key Files

- `src/app/page.tsx` - Main dashboard (server component)
- `src/app/api/auth/[...nextauth]/route.ts` - NextAuth Strava OAuth config
- `src/components/BikeDashboard/` - Bike selector with client-side state
- `src/components/selectedBike/` - Selected bike detail view with SVG and wear progress bars

### Patterns

- Server components for pages, `"use client"` for interactive components
- Path alias: `@/*` maps to `./src/*`
- JWT session strategy with NextAuth

## Environment Variables

Required in `.env.local`:

- `STRAVA_CLIENT_ID` - OAuth client ID
- `STRAVA_CLIENT_SECRET` - OAuth client secret
- `ACCESS_TOKEN` - Strava API access token
- `NEXTAUTH_SECRET` - Required for production

## Security requirements:

- Never commit, push, or suggest committing `.env` files, API keys, Strava tokens, secrets, or any other sensitive credentials.
- Always assume secrets must be stored securely using environment variables or a secrets manager.
- When generating code examples, ensure that placeholder values (e.g., `STRAVA_CLIENT_SECRET`) are used instead of real secrets.
- Avoid logging sensitive data in server logs, console output, or debugging tools.
- Follow the principle of least privilege when suggesting database schemas, API scopes, or Strava permissions.

## Code quality requirements:

- All code should follow the project's linting and formatting rules.
- Before any commit, ensure that `npm run lint` passes without errors.
- When generating code, follow consistent naming conventions, clear structure, and idiomatic patterns for the chosen tech stack.
- Prefer modular, testable functions and components.
- When suggesting refactors or improvements, prioritize readability, maintainability, and long‑term scalability.

## Sub-Agents

Specialized agents for delegating complex tasks (see `.claude/agents/`):

| Agent | Role |
|-------|------|
| master-orchestrator | Coordinate multi-step tasks, plan implementations, delegate to specialists |
| supabase-specialist | Database schemas, migrations, RLS policies, queries |
| backend-engineer | Server actions, Strava integration, business logic |
| frontend-specialist | React components, shadcn/ui, D3.js, SVG interactions |
| performance-optimizer | Analyze and fix performance bottlenecks |
| security-auditor | Review code for vulnerabilities, audit auth flows |
| qa-engineer | Test strategies, coverage planning, acceptance criteria |

## Documentation

- [Project Spec](./docs/project_spec.md) - Full requirements, API spec, tech details
- [Architecture](./docs/architecture.md) - System design and data flow
- [Changelog](./docs/changelog.md) - Version history
- [Project Status](./docs/project_status.md) - Current progress
- [MCP Setup](./docs/mcp-setup.md) - MCP server configuration

Update files in the docs folder (except project_spec.md) after major milestones.
